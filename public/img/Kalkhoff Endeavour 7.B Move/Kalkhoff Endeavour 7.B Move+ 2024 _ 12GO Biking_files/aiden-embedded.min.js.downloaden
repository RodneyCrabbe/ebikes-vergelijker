(function(){"use strict";function Q(){const e="aiden-storage-test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}function q(){const e="aiden-storage-test";try{return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch{return!1}}const ee=()=>q()?sessionStorage:U,te=()=>Q()?localStorage:q()?sessionStorage:U,A={},U=ne();function ne(){return{getItem:e=>A[e]||null,setItem:(e,t)=>{A[e]=t},removeItem:e=>{delete A[e]}}}const S={session:ee(),local:te()},m={};let y=[];function oe(e,t){const n={type:"AdvisorSeen",userId:ae(),path:window.location.pathname,domain:window.location.host,userAgent:navigator.userAgent,resolution:ie(),screenSize:re()};fetch(`https://app.aiden.cx/webshop-api/v1/forms/website-analytics/${e}?&mode=${t}`,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(n)})}function ae(){const e=S.local.getItem("aidenUserId");if(!e){const t=window.crypto.getRandomValues(new Uint32Array(1))[0].toString();return S.local.setItem("aidenUserId",t),t}return e}function ie(){return{width:screen.width||0,height:screen.height||0}}function re(){const e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0;return{width:e,height:t}}function se(e){y=y.filter(t=>e.indexOf(t)>=0),e.forEach(t=>{if(y.indexOf(t)>=0)return;y.push(t);const n=ce(t),o=le(t);if(!n)return;const a={rootMargin:"0px",threshold:o==="modal"?.9:.5};new IntersectionObserver(d=>{d.forEach(l=>{l.isIntersecting&&n&&!m[n]?m[n]=setTimeout(()=>{oe(n,o),m[n]="sent"},3e3):!l.isIntersecting&&m[n]!=="sent"&&(clearTimeout(m[n]),m[n]=void 0)})},a).observe(t)})}function de(e){return e instanceof HTMLElement&&(_(e)||R(e))}function _(e){return e instanceof HTMLIFrameElement&&e.tagName==="IFRAME"&&e.id&&e.id.startsWith("aiden-")&&j(e.id.replace("aiden-",""))}function R(e){return e.dataset&&"advisorId"in e.dataset&&j(e.dataset.advisorId||"")}function ce(e){if(R(e))return e.dataset.advisorId;if(_(e))return e.id.replace("aiden-","")}function le(e){if(e instanceof HTMLIFrameElement){const t=new URLSearchParams(e.src);if(t.has("mode"))return t.get("mode")==="inpage"?"inpage":"banner"}return"modal"}function j(e){return RegExp(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i).test(e)}function z(){const e=Array.from(document.querySelectorAll("iframe, [data-advisor-id]")).filter(t=>de(t));se(e)}function F(){const e=(o,a)=>{a.disconnect();try{z(),F()}catch(i){console.error(i)}},t=new MutationObserver(e),n={attributes:!0,subtree:!0,childList:!0};t.observe(document.documentElement,n)}const N=S.local,H=btoa("aiden-storage"),D=e=>{const t=e.getItem(H)||"{}";return me(t)},ue=(e,t)=>{const n=e.data.sessionId,o=e.advisorId;if(n&&o&&fe.includes(e.type)){const a=D(t),i=a[o]||new Set,d=pe({...a,[o]:i.add(n)});t.setItem(H,d)}},fe=["answered-event","advised-event","completed-event","start-over-event","product-clicked-event","session-activity"];function K(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,[...n]]))}function pe(e){return btoa(JSON.stringify(K(e)))}function me(e){try{const t=JSON.parse(atob(e));return t instanceof Object&&!(t instanceof Array)?Object.fromEntries(Object.entries(t).map(([n,o])=>o instanceof Array?[n,o.every(a=>typeof a=="string")?new Set(o):new Set]:[n,o])):{}}catch{return{}}}function he(e){const t=["debug","apiKey","orderId","currency"],n=["aidenProductId","quantity","price"],o=(e.products||[]).map(i=>{if(typeof i=="object"&&!Array.isArray(i))return n.reduce((d,l)=>({...d,[l]:i[l]}),{})}).filter(function(i){return i!=null});return t.reduce((i,d)=>({...i,[d]:e[d]}),{products:o})}const ge=".aiden-lock-screen{overflow:hidden!important}.aiden-ios-lock-html{height:100%;overflow:hidden}.aiden-lock-screen.aiden-ios-lock-fix{position:fixed;width:100%;height:auto;overflow:hidden}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.aiden-modal{width:100%;height:100%;position:fixed;top:0;right:0;left:0;bottom:0;display:flex;pointer-events:all;z-index:2147483629;animation:fadeIn .5s ease-in;-webkit-overflow-scrolling:touch;transition:opacity .15s}.aiden-modal.is-hidden{opacity:0;z-index:1!important;pointer-events:none;visibility:hidden}.aiden-modal .aiden-modal-content{position:relative;z-index:2147483629;flex:1 1 auto;-webkit-overflow-scrolling:touch}.aiden-modal .aiden-modal-loading{position:absolute;left:0;top:0;height:100%;width:100%;align-items:center;display:flex;justify-content:center;background:#0000004d;color:#fff}.aiden-modal iframe{width:100%;height:100%;border:none}";function ye(e,t){E(t,n=>{n.style.zIndex=Math.round(e).toString()})}function we(e){E(e,t=>{t.classList.add("is-hidden"),Y(document.body,document.documentElement)})}function B(e){E(e,t=>{t.classList.remove("is-hidden"),$(document.body)})}function E(e,t){const n=document.querySelector("#aiden-modal-"+e);n&&t(n)}function ve(e,t){const n=new CustomEvent("aiden-actions",{detail:{type:"action",advisorId:e.advisorId,advisorName:e.advisorName,actionId:e.data.actionId,products:e.data.products.map(o=>({id:o.id,name:o.name,quantity:o.quantity})),successCallback:()=>{t(w(e,"SUCCEEDED"))},failedCallback:()=>{t(w(e,"FAILURE"))},acknowledgeCallback:()=>{t(w(e,"ACKNOWLEDGED"))},abortCallback:()=>{t(w(e,"ABORTED"))},setAppZIndex:o=>ye(o,e.advisorId),hideApp:()=>we(e.advisorId),showApp:()=>B(e.advisorId)}});window.dispatchEvent(n)}function w(e,t){return{type:"action-callback",status:t,advisorId:e.advisorId,advisorName:e.advisorName,actionId:e.data.actionId,triggerId:e.data.triggerId,products:e.data.products}}function be(e){if(!(typeof e=="object"&&e!==null&&"advisorId"in e&&"advisorName"in e&&typeof e.advisorId=="string"&&typeof e.advisorName=="string"&&"data"in e&&typeof e.data=="object"&&e.data!==null&&"type"in e&&typeof e.type=="string"&&e.type==="action"))return!1;const t=e.data;return"actionId"in t&&"products"in t&&"triggerId"in t&&typeof t.triggerId=="string"&&typeof t.actionId=="string"}const h=window.navigator,k="aidenModal",P="aidenSidebar",L="aidenAiSidebar",v="aidenProductCheck";let g;function x(e,t,n){const o="aiden-modal-"+e,a=document.querySelector(".aiden-modal"),d=[...n,["mode",t]].map(([C,T])=>C+"="+encodeURIComponent(T)).join("&"),l=d?"&"+d:"";if(a&&a.id===o){B(e);return}a&&a.remove(),ke(e,t,n);const b="https://app.aiden.cx/webshop/?advisorId="+e+l,r=document.createElement("div");r.id="aiden-modal-"+e;const c="aiden-iframe-"+e,s="<div class='aiden-modal-content'><style>"+ge+"</style><iframe name='"+c+"' id='aiden-modal-frame' allowtransparency='true' style='background-color:transparent;' src='"+b+"'>      </iframe>      <div id='aiden-modal-loading' class='aiden-modal-loading'>        <svg class='aiden-loading-icon' xmlns='http://www.w3.org/2000/svg' width='50' height='50' display='block' preserveAspectRatio='xMidYMid' viewBox='0 0 100 100'><style>.aiden-loading-icon{animation:rotate 1s linear infinite;}@keyframes rotate{from{transform: rotate(0deg);}to{transform: rotate(360deg);}</style><circle cx='50' cy='50' r='41' fill='none' stroke='currentColor' stroke-dasharray='193.208 66.403' stroke-width='10'></circle></svg>      </div>    </div>";r.className="aiden-modal",r.innerHTML=s.trim();const u=document.body;$(u),u.appendChild(r);const f=document.getElementById("aiden-modal-frame"),I=document.getElementById("aiden-modal-loading");Ae()&&f&&f.focus(),f&&f.addEventListener("load",function(){I&&(I.style.display="none")})}function Ie(e,t){W()&&window.requestAnimationFrame(()=>{if(g===void 0){g={...e.style};const{scrollY:n,innerHeight:o}=window;e.style.top=`${-n}px`,e.classList.add("aiden-ios-lock-fix"),t.classList.add("aiden-ios-lock-html"),setTimeout(()=>window.requestAnimationFrame(()=>{const a=o-window.innerHeight;a&&n>=o&&(e.style.top=-(n+a)+"px")}),300)}})}function W(){return/iPad|iPhone|iPod/.test(h.platform)||h.platform==="MacIntel"&&h.maxTouchPoints>1}function Ae(){return!h.userAgent.includes("Chrome")&&h.userAgent.includes("Safari")}function J(e){e.preventDefault(),e.stopPropagation()}function $(e){e.classList.add("aiden-lock-screen"),e.addEventListener("touchmove",J,{passive:!1}),Ie(document.body,document.documentElement)}function Y(e,t){e.classList.remove("aiden-lock-screen"),e.removeEventListener("touchmove",J),Se(e,t)}function Se(e,t){if(W()&&g!==void 0){const n=-parseInt(document.body.style.top,10);e.style.top=g.top||"",e.classList.remove("aiden-ios-lock-fix"),t.classList.remove("aiden-ios-lock-html");try{const o={top:n,left:0,behavior:"instant"};typeof window.scroll=="function"?window.scroll(o):typeof window.scrollTo=="function"&&window.scrollTo(o)}catch{}g=void 0}}function Ee(){const e=document.querySelector(".aiden-modal"),t=document.body,n=document.documentElement;Y(t,n),Pe(),e&&e.remove()}function G(){const e=new URLSearchParams(window.location.search),t=new URL(window.location.href.replace(window.location.search,""));return e.delete(k),e.delete(P),e.delete(L),{url:t,params:e}}function V(e,t){t.forEach((n,o)=>{e.searchParams.set(o,n)}),history.replaceState({},"",e.href)}function ke(e,t,n){const{url:o,params:a}=G();a.set(t==="sidebar"?P:t==="ai-sidebar"?L:k,e),n.forEach(([i,d])=>{i==="productId"&&a.set(v,d),i==="productUrl"&&a.set(v,"")}),V(o,a)}function Pe(){const{url:e,params:t}=G();t.delete(v),V(e,t)}function O(e){return new URLSearchParams(window.location.search).get(e)}function Le(){return M(O(k))}function xe(){return M(O(P))}function Oe(){return M(O(L))}function M(e){return(e==null?void 0:e.replace(/[^a-zA-Z0-9\-]/g,""))||null}function Me(e){e.type==="background-click"&&Ee()}const Z=-100,Ce=e=>!!e&&typeof e=="object"&&"type"in e&&typeof e.type=="string",Te=e=>!!e&&typeof e=="object"&&"advisorId"in e&&typeof e.advisorId=="string",qe=e=>!!e&&typeof e=="object"&&"data"in e&&typeof e.data=="object",Ue=e=>qe(e)&&"height"in e.data&&typeof e.data.height=="number";function _e(e){const t=e.data;if(t&&Ce(t)&&Te(t)){const o=document.querySelector("iframe#aiden-"+t.advisorId.trim())||Re(e);if(!o||o.id==="aiden-modal-frame")return;if(t.type==="viewport-dimensions"&&Ue(t)){var n=`${t.data.height+1}px`;o.style.height=n,t.data.height<100?o.style.minHeight="100px":o.style.minHeight=n}if(t.type==="screen-change")try{const a=je(o),i=o.getBoundingClientRect().top+window.pageYOffset+a;window.scrollTo({top:i,behavior:"smooth"})}catch{}}}function Re(e){const t=document.querySelectorAll("iframe");return Array.from(t).find(n=>{var o;return n.contentWindow===e.source||((o=n.contentDocument)==null?void 0:o.defaultView)===e.source})||null}function je(e){if(!e)return Z;const t=e.dataset.scrolloffset||e.getAttribute("scrollOffset"),n=parseInt(t||"");return isFinite(n)?n:Z}function ze(){return new Promise(e=>{if(document.body)e(document.body);else{const t=new MutationObserver(()=>{document.body&&(e(document.body),t.disconnect())});t.observe(document.documentElement,{childList:!0,subtree:!0})}})}function Fe(){try{z(),F()}catch(r){console.error(r)}Ke();const e=document.querySelectorAll("[data-advisor-id]"),t=r=>{const c=r.getAttribute("data-product-check");return c===null?[]:c.trim()!==""?[["productId",c]]:[["productUrl",window.location.href.split("?")[0]]]},n=r=>{const s=[r.getAttribute("data-reset-on-start")!==null?"resetOnStart":""].filter(f=>f!=="").join(",");return s.length?[["modifiers",s]]:[]},o=function(r){const c=r==null?void 0:r.target;if(c instanceof Element){const s=c.getAttribute("data-advisor-id")?c:c.closest("[data-advisor-id]"),u=s==null?void 0:s.getAttribute("data-advisor-id"),f=s?t(s):[],I=s?n(s):[],C=[...f,...I],T=(s==null?void 0:s.getAttribute("data-aiden-mode"))==="sidebar"?"sidebar":(s==null?void 0:s.getAttribute("data-aiden-mode"))==="ai-sidebar"?"ai-sidebar":"modal";u&&x(u,T,C)}},a=Le(),i=xe(),d=Oe(),l=d?"ai-sidebar":i?"sidebar":"modal",b=a||i||d;b&&ze().then(()=>{x(b,l,Be())}),e.forEach(function(r){r.addEventListener("click",o)}),window.addEventListener("click",o),window.addEventListener("message",r=>{if(Ne(r.data)){const c=r.data;Me(c),_e(r),He(c)&&ue(c,N),be(c)&&ve(c,s=>{var u;return(u=r.source)==null?void 0:u.postMessage(s,{targetOrigin:r.origin})})}}),De()}const Ne=e=>e!==null&&typeof e=="object"&&!(e instanceof Array)&&"data"in e&&"advisorId"in e&&"type"in e,He=e=>"sessionId"in e.data&&typeof e.data.sessionId=="string",De=()=>{const e=document.getElementsByTagName("IFRAME");Array.from(e).forEach(t=>{t instanceof HTMLIFrameElement&&t.id.startsWith("aiden-")&&t.contentWindow&&t.contentWindow.window.postMessage({type:"init"},"*")})};function Ke(){try{typeof Element<"u"&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!t)return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(t!==null&&t.nodeType===1);return null}))}catch{}}window._aidenApp={openAdvisor:x};function Be(){const t=new URLSearchParams(window.location.search).get(v);return t===null?[]:t.trim()!==""?[["productId",t]]:[["productUrl",window.location.href.split("?")[0]]]}function We(){window.addEventListener("message",function(e){var n,o,a,i;const t=(n=e.data)==null?void 0:n.eventData;((o=e.data)==null?void 0:o.integration)==="aiden:google_tag_manager"&&typeof((a=e.data)==null?void 0:a.type)=="string"&&t&&(window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:(i=e.data)==null?void 0:i.type,...t}))})}function Je(){window.addEventListener("message",function(e){var n,o,a,i;const t=(n=e.data)==null?void 0:n.eventData;((o=e.data)==null?void 0:o.integration)==="aiden:google_analytics"&&typeof((a=e.data)==null?void 0:a.type)=="string"&&t&&(typeof gtag=="function"?gtag("event",(i=e.data)==null?void 0:i.type,t):setTimeout(()=>{var d;typeof gtag=="function"&&gtag("event",(d=e.data)==null?void 0:d.type,t)},2e3))})}function $e(){window._sqzl=window._sqzl||[],window.addEventListener("message",function(e){var n,o;const t=(n=e.data)==null?void 0:n.eventData;((o=e.data)==null?void 0:o.integration)==="aiden:squeezely"&&t&&window._sqzl.push(t)})}function Ye(){window.addEventListener("message",function(e){var n,o,a;const t=(n=e.data)==null?void 0:n.eventData;((o=e.data)==null?void 0:o.integration)==="aiden:bloomreach"&&typeof((a=e.data)==null?void 0:a.type)=="string"&&t&&(window.exponea?window.exponea.track(e.data.type,t):setTimeout(()=>{window.exponea&&window.exponea.track(e.data.type,t)},2e3))})}function p(e,t=void 0){console.group("Aiden"),t?console.error(e,t):console.error(e),console.groupEnd()}function X(e){const t=K(D(N));try{if(!(typeof e=="object"&&!Array.isArray(e))){p("purchase event provided was not a correctly formed object");return}if(Ve(e,t))return;if(typeof e=="object"&&"apiKey"in e&&typeof e.apiKey=="string"){const n=new XMLHttpRequest,o=e.apiKey;n.open("POST","https://app.aiden.cx/webshop-api/v1/purchase",!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Accept","application/json, text/plain, */*"),n.responseType="text",n.setRequestHeader("X-API-KEY",o),n.send(JSON.stringify({...he(e),sessions:t})),n.onloadend=()=>{n.status===200&&(e!=null&&e.debug)&&(console.group("Aiden"),console.info("Purchase event sent succesfully"),console.groupEnd()),(n.status===400||n.status===422)&&p("There was something wrong when sending the purchase event",JSON.parse(n.responseText)),n.status===403&&p("The API key you have provided is invalid.")}}else p("An API key was not provided for the purchase event. Include an 'apiKey' key and provide the key which starts with 'AID-'");return}catch(n){p("",n);return}}function Ge(e){e._aiden||(e._aiden=[]);try{if(e._aiden.push=function(n){return typeof n=="object"&&"event"in n&&typeof n.event=="string"&&(n.event.toLowerCase()==="purchase"?X(n):p("Unknown event type: "+n.event)),1},e._aiden&&Array.isArray(e._aiden)){for(var t=0;t<e._aiden.length;t++)X(e._aiden[t]);e._aiden.length=0}}catch{p("Failed to send purchase event");return}}function Ve(e,t){const n=Object.entries(t).some(([a,i])=>i.length!==0)&&Object.entries(t).length>0;if(e===null)return!1;const o=Object.fromEntries(Object.entries(e).map(([a,i])=>[a.toLowerCase(),i]));return typeof o!="object"||!("requiresession"in o)?!1:o.requiresession===!0&&!n}function Ze(){window._sqzl=window._sqzl||[],window.addEventListener("message",function(e){var n,o;const t=(n=e.data)==null?void 0:n.eventData;((o=e.data)==null?void 0:o.integration)==="aiden:spotler_activate"&&t&&window._sqzl.push(t)})}Ge(window),Fe(),$e(),Ze(),Ye(),We(),Je()})();
